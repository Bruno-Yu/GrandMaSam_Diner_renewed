"use strict";(self["webpackChunkgrandmasam_diner_renewed"]=self["webpackChunkgrandmasam_diner_renewed"]||[]).push([[988],{7281:function(e,t,a){a.d(t,{A:function(){return _}});var s=a(641),l=a(33);const o={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},d={class:"modal-dialog",role:"document"},i={class:"modal-content border-0"},r={class:"modal-header bg-danger text-white"},n={class:"modal-title"},u=(0,s.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),c={class:"modal-body"},h={class:"text-danger"},p={class:"modal-footer"},k=(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function L(e,t,a,L,g,m){return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",d,[(0,s.Lk)("div",i,[(0,s.Lk)("div",r,[(0,s.Lk)("h5",n,[(0,s.Lk)("span",null,"刪除 "+(0,l.v_)(g.orderShow.title),1)]),u]),(0,s.Lk)("div",c,[(0,s.eW)(" 是否刪除 "),(0,s.Lk)("strong",h,(0,l.v_)(g.orderShow.title),1),(0,s.eW)(" (刪除後將無法恢復)。 ")]),(0,s.Lk)("div",p,[k,(0,s.Lk)("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...e)=>m.updateModal&&m.updateModal(...e))},"確認刪除")])])])],512)}var g=a(9635),m=a.n(g),b={props:["order"],data(){return{modal:"",orderShow:{}}},watch:{order(){this.orderShow=this.order}},emits:["del-item"],methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},updateModal(){this.$emit("del-item")}},mounted(){this.modal=new(m())(this.$refs.modal)}},v=a(6262);const w=(0,v.A)(b,[["render",L]]);var _=w},4402:function(e,t,a){a.d(t,{A:function(){return g}});var s=a(641),l=a(33),o=a(3751);const d={"aria-label":"Page navigation"},i={class:"pagination justify-content-center"},r=["aria-disabled"],n={key:0,class:"page-link link-dark fw-bold"},u=["onClick"],c=["aria-disabled"];function h(e,t,a,h,p,k){return(0,s.uX)(),(0,s.CE)("nav",d,[(0,s.Lk)("ul",i,[(0,s.Lk)("li",{class:(0,l.C4)(["page-item",{disabled:!a.hasPre}])},[(0,s.Lk)("a",{class:"page-link link-dark fw-bold",href:"#",tabindex:"-1","aria-disabled":!a.hasPre,onClick:t[0]||(t[0]=(0,o.D$)((e=>k.emitData(a.currentPage-1)),["prevent"]))},"上一頁",8,r)],2),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.totalPages,((e,t)=>((0,s.uX)(),(0,s.CE)("li",{class:(0,l.C4)(["page-item",{active:e===a.currentPage}]),key:t},[e===a.currentPage?((0,s.uX)(),(0,s.CE)("span",n,(0,l.v_)(e),1)):((0,s.uX)(),(0,s.CE)("a",{key:1,class:"page-link link-dark fw-bold",href:"#",onClick:(0,o.D$)((t=>k.emitData(e)),["prevent"])},(0,l.v_)(e),9,u))],2)))),128)),(0,s.Lk)("li",{class:(0,l.C4)(["page-item",{disabled:!a.hasNext}])},[(0,s.Lk)("a",{class:"page-link fw-bold",href:"#","aria-disabled":!a.hasNext,onClick:t[1]||(t[1]=(0,o.D$)((e=>k.emitData(a.currentPage+1)),["prevent"]))},"下一頁",8,c)],2)])])}var p={data(){return{}},props:["currentPage","hasPre","hasNext","totalPages"],methods:{emitData(e){this.$emit("click-page",e)}}},k=a(6262);const L=(0,k.A)(p,[["render",h]]);var g=L},2988:function(e,t,a){a.r(t),a.d(t,{default:function(){return ve}});var s=a(641),l=a(33),o=a(3751);const d=(0,s.Lk)("h2",{class:"my-5 ms-2 fw-bold text-center"},"訂單管理頁面",-1),i={class:"p-5"},r={class:"table mt-4"},n=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{scope:"col"},"訂單號"),(0,s.Lk)("th",{scope:"col"},"下訂時間"),(0,s.Lk)("th",{scope:"col"},"Email"),(0,s.Lk)("th",{scope:"col"},"購買品項"),(0,s.Lk)("th",{scope:"col"},"應付金額"),(0,s.Lk)("th",{scope:"col"},"是否付款"),(0,s.Lk)("th",{scope:"col"},"編輯")])],-1),u={key:0},c={key:0},h={class:"list-group-numbered"},p={class:"text-right"},k={class:"form-check form-switch"},L=["id","onUpdate:modelValue","onChange"],g=["for"],m={key:0},b={key:1},v={class:"btn-group"},w=["onClick","disabled"],_={class:"spinner-grow spinner-grow-sm"},f=["onClick","disabled"],y={class:"spinner-grow spinner-grow-sm"};function C(e,t,a,C,x,S){const D=(0,s.g2)("PageLoading"),$=(0,s.g2)("OrderDetail"),M=(0,s.g2)("OrderDelete"),P=(0,s.g2)("PaginationFooter");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(D,{loader:"bars",active:x.isLoading,"can-cancel":!0,"is-full-page":!1},null,8,["active"]),d,(0,s.Lk)("div",i,[(0,s.Lk)("table",r,[n,x.orders.length?((0,s.uX)(),(0,s.CE)("tbody",u,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(x.orders,((e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t,class:(0,l.C4)({"text-secondary":!e.is_paid})},[(0,s.Lk)("td",null,(0,l.v_)(e.id),1),(0,s.Lk)("td",null,(0,l.v_)(e.create_at),1),e.user?((0,s.uX)(),(0,s.CE)("td",c,(0,l.v_)(e.user.email),1)):(0,s.Q3)("",!0),(0,s.Lk)("td",null,[(0,s.Lk)("ul",h,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.products,((e,t)=>((0,s.uX)(),(0,s.CE)("li",{class:"list-group-item",key:t},(0,l.v_)(e.product.title)+" 數量："+(0,l.v_)(e.qty)+" "+(0,l.v_)(e.product.unit),1)))),128))])]),(0,s.Lk)("td",p,(0,l.v_)(e.total)+" 元",1),(0,s.Lk)("td",null,[(0,s.Lk)("div",k,[(0,s.bo)((0,s.Lk)("input",{class:"form-check-input",type:"checkbox",id:`switch${e.id}`,"onUpdate:modelValue":t=>e.is_paid=t,onChange:t=>S.updatePaid(e)},null,40,L),[[o.lH,e.is_paid]]),(0,s.Lk)("label",{class:"form-check-label",for:`switch${e.id}`},[e.is_paid?((0,s.uX)(),(0,s.CE)("span",m,"已付款")):((0,s.uX)(),(0,s.CE)("span",b,"未付款"))],8,g)])]),(0,s.Lk)("td",null,[(0,s.Lk)("div",v,[(0,s.Lk)("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:t=>S.openModal(e),disabled:x.isLoadingItem===e.id},[(0,s.bo)((0,s.Lk)("span",_,null,512),[[o.aG,x.isLoadingItem===e.id]]),(0,s.eW)(" 檢視 ")],8,w),(0,s.Lk)("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:t=>S.openDelModal(e),disabled:x.isLoadingItem===e.id},[(0,s.bo)((0,s.Lk)("span",y,null,512),[[o.aG,x.isLoadingItem===e.id]]),(0,s.eW)(" 刪除 ")],8,f)])])],2)))),128))])):(0,s.Q3)("",!0)])]),(0,s.bF)($,{order:x.orderShow,ref:"orderDetail",onUpdatePaid:S.updatePaid},null,8,["order","onUpdatePaid"]),(0,s.bF)(M,{order:x.orderShow,ref:"delModal",onDelItem:S.delOrder},null,8,["order","onDelItem"]),(0,s.bF)(P,{"current-page":x.current_page,"has-pre":x.has_pre,"has-next":x.has_next,"total-pages":x.total_pages,onClickPage:S.getOrders},null,8,["current-page","has-pre","has-next","total-pages","onClickPage"])],64)}const x={class:"modal fade",tabindex:"-1",role:"dialog",id:"orderDetail","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl",role:"document"},D={class:"modal-content border-0"},$=(0,s.Lk)("div",{class:"modal-header bg-dark text-white"},[(0,s.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,s.Lk)("span",null,"訂單細節")]),(0,s.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),M={class:"modal-body"},P={class:"row"},E={class:"col-md-4"},X=(0,s.Lk)("h3",null,"用戶資料",-1),I={class:"table"},F={key:0},O=(0,s.Lk)("th",{style:{width:"100px"}},"姓名",-1),A=(0,s.Lk)("th",null,"Email",-1),K=(0,s.Lk)("th",null,"電話",-1),N=(0,s.Lk)("th",null,"地址",-1),U={class:"col-md-8"},W=(0,s.Lk)("h3",null,"訂單細節",-1),q={class:"table"},Q=(0,s.Lk)("th",{style:{width:"100px"}},"訂單編號",-1),V=(0,s.Lk)("th",null,"下單時間",-1),Y=(0,s.Lk)("th",null,"付款時間",-1),j={key:0},G={key:1},H=(0,s.Lk)("th",null,"付款狀態",-1),T={key:0,class:"text-success"},z={key:1,class:"text-muted"},B=(0,s.Lk)("th",null,"總金額",-1),J=(0,s.Lk)("h3",null,"選購商品",-1),R={class:"table"},Z=(0,s.Lk)("thead",null,[(0,s.Lk)("tr")],-1),ee={class:"text-end"},te={class:"d-flex justify-content-end"},ae={class:"form-check"},se={class:"form-check-label",for:"flexCheckDefault"},le={key:0},oe={key:1},de={class:"modal-footer"},ie=(0,s.Lk)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function re(e,t,a,d,i,r){return(0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("div",S,[(0,s.Lk)("div",D,[$,(0,s.Lk)("div",M,[(0,s.Lk)("div",P,[(0,s.Lk)("div",E,[X,(0,s.Lk)("table",I,[i.orderShow.user?((0,s.uX)(),(0,s.CE)("tbody",F,[(0,s.Lk)("tr",null,[O,(0,s.Lk)("td",null,(0,l.v_)(i.orderShow.user.name),1)]),(0,s.Lk)("tr",null,[A,(0,s.Lk)("td",null,(0,l.v_)(i.orderShow.user.email),1)]),(0,s.Lk)("tr",null,[K,(0,s.Lk)("td",null,(0,l.v_)(i.orderShow.user.tel),1)]),(0,s.Lk)("tr",null,[N,(0,s.Lk)("td",null,(0,l.v_)(i.orderShow.user.address),1)])])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",U,[W,(0,s.Lk)("table",q,[(0,s.Lk)("tbody",null,[(0,s.Lk)("tr",null,[Q,(0,s.Lk)("td",null,(0,l.v_)(i.orderShow.id),1)]),(0,s.Lk)("tr",null,[V,(0,s.Lk)("td",null,(0,l.v_)(r.CreateDate),1)]),(0,s.Lk)("tr",null,[Y,(0,s.Lk)("td",null,[i.orderShow.paid_date?((0,s.uX)(),(0,s.CE)("span",j,(0,l.v_)(r.PaidDate),1)):((0,s.uX)(),(0,s.CE)("span",G,"時間不正確"))])]),(0,s.Lk)("tr",null,[H,(0,s.Lk)("td",null,[i.orderShow.is_paid?((0,s.uX)(),(0,s.CE)("strong",T,"已付款")):((0,s.uX)(),(0,s.CE)("span",z,"尚未付款"))])]),(0,s.Lk)("tr",null,[B,(0,s.Lk)("td",null,(0,l.v_)(i.orderShow.total),1)])])]),J,(0,s.Lk)("table",R,[Z,(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.orderShow.products,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("th",null,(0,l.v_)(e.product.title),1),(0,s.Lk)("td",null,(0,l.v_)(e.qty)+" / "+(0,l.v_)(e.product.unit),1),(0,s.Lk)("td",ee,(0,l.v_)(e.final_total),1)])))),128))])]),(0,s.Lk)("div",te,[(0,s.Lk)("div",ae,[(0,s.bo)((0,s.Lk)("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":t[0]||(t[0]=e=>i.orderShow.is_paid=e)},null,512),[[o.lH,i.orderShow.is_paid]]),(0,s.Lk)("label",se,[i.orderShow.is_paid?((0,s.uX)(),(0,s.CE)("span",le,"已付款")):((0,s.uX)(),(0,s.CE)("span",oe,"未付款"))])])])])])]),(0,s.Lk)("div",de,[ie,(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=(...e)=>r.updateOrder&&r.updateOrder(...e))},"修改付款狀態")])])])],512)}var ne=a(9635),ue=a.n(ne),ce={props:["order"],data(){return{status:{},modal:"",orderShow:{},isPaid:!1}},computed:{CreateDate(){const e=new Date(1e3*this.orderShow.create_at),t=e.getFullYear(),a=e.getMonth()+1,s=e.getDate(),l=`${t}/${a}/${s}`;return l},PaidDate(){const e=new Date(1e3*this.orderShow.is_paid),t=e.getFullYear(),a=e.getMonth()+1,s=e.getDate(),l=`${t}/${a}/${s}`;return l}},watch:{order(){this.orderShow=this.order}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},updateOrder(){this.$emit("update-paid",this.orderShow)}},mounted(){this.modal=new(ue())(document.querySelector("#orderDetail"))}},he=a(6262);const pe=(0,he.A)(ce,[["render",re]]);var ke=pe,Le=a(7281),ge=a(4402),me={data(){return{orders:{},isNew:!1,current_page:1,has_next:!1,has_pre:!1,isLoading:!1,isLoadingItem:"",total_pages:1,orderShow:{},currentPage:1}},components:{PaginationFooter:ge.A,OrderDelete:Le.A,OrderDetail:ke},methods:{dateTimeFormat(e){const t=new Date(1e3*e),a=t.getFullYear(),s=t.getMonth()+1,l=t.getDate(),o=`${a}/${s}/${l}`;return o},getOrders(e=1){this.isLoading=!0,this.currentPage=e;const t=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/orders?page=${e}`;this.$http.get(t,e).then((e=>{this.orders=e.data.orders.map((e=>({...e,create_at:this.dateTimeFormat(e.create_at)}))),this.current_page=e.data.pagination.current_page,this.has_next=e.data.pagination.has_next,this.has_pre=e.data.pagination.has_pre,this.total_pages=e.data.pagination.total_pages,this.isLoading=!1})).catch((e=>{this.isLoading=!1,this.$httpMessageState(e.response,"錯誤訊息")}))},openModal(e){this.isLoadingItem=e.id,this.orderShow={...e},this.isNew=!1,this.$refs.orderDetail.openModal(),this.isLoadingItem="",this.isLoading=!1},openDelModal(e){this.isLoadingItem=e.id,this.orderShow={...e},this.$refs.delModal.openModal(),this.isLoadingItem="",this.isLoading=!1},updatePaid(e){this.isLoadingItem=e.id;const t=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/order/${e.id}`,a={is_paid:e.is_paid};this.$http.put(t,{data:a}).then((e=>{this.$refs.orderDetail.closeModal(),this.getOrders(this.currentPage),this.$httpMessageState(e,"更新付款狀態"),this.isLoadingItem="",this.isLoading=!1})).catch((e=>{this.$httpMessageState(e.response,"錯誤訊息"),this.isLoadingItem="",this.isLoading=!1}))},delOrder(){this.isLoadingItem=this.orderShow.id;const e=`https://vue3-course-api.hexschool.io/v2//api/brunoyu2022/admin/order/${this.orderShow.id}`;this.$http.delete(e).then((()=>{this.$refs.delModal.closeModal(),this.isLoadingItem="",this.getOrders(this.currentPage)})).catch((e=>{this.$httpMessageState(e.response,"錯誤訊息"),this.isLoadingItem=""})),this.isLoadingItem="",this.isLoading=!1}},created(){this.isLoading=!0,this.getOrders(),this.isLoading=!1}};const be=(0,he.A)(me,[["render",C]]);var ve=be}}]);
//# sourceMappingURL=988.27b66d17.js.map